<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solicitud de Vacaciones - Strata Pavimentos</title>
<style>
body { font-family: Arial; margin:0; padding:10px; background:#525659; }
.container { max-width:600px; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3); }
h1 { text-align:center; font-size:18px; margin-bottom:15px; }
.field { margin-bottom:12px; display:flex; flex-direction:column; }
.field label { font-weight:bold; margin-bottom:5px; }
input, select, button { padding:10px; font-size:14px; border-radius:5px; border:1px solid #999; width:100%; box-sizing:border-box; }
button { background:#27ae60; color:white; border:none; margin-top:10px; cursor:pointer; font-weight:bold; font-size:16px; }
button:hover { background:#219150; }
canvas { border:1px solid #000; width:100%; height:120px; margin-top:5px; }
.clear-btn { background:#e74c3c; color:white; font-size:12px; padding:3px 8px; border:none; cursor:pointer; border-radius:3px; margin-top:5px; align-self:flex-end; }
#total_dias { text-align:center; font-weight:bold; background:#e8f4fd; border:1px solid #3498db; width:80px; margin-top:5px; }
</style>
</head>
<body>

<div class="container">
<h1>Solicitud de Vacaciones</h1>

<div class="field"><label>Nombre completo:</label><input type="text" id="nombre"></div>
<div class="field"><label>DNI:</label><input type="text" id="dni"></div>
<div class="field"><label>Empresa:</label>
<select id="empresa">
<option value="">-- Seleccione --</option>
<option value="Strata Pavimentos, S.L.">Strata Pavimentos, S.L.</option>
<option value="Touchit, S.L.">Touchit, S.L.</option>
<option value="Inversiones Tierra de Barros, S.L.">Inversiones Tierra de Barros, S.L.</option>
</select>
</div>
<div class="field"><label>Tipo de solicitud:</label>
<select id="tipo">
<option value="Vacaciones">Vacaciones</option>
<option value="Permiso">Permiso</option>
<option value="Otros">Otros</option>
</select>
</div>

<div class="field"><label>Fecha inicio:</label><input type="date" id="fecha_inicio" onchange="calcularDias()"></div>
<div class="field"><label>Fecha fin:</label><input type="date" id="fecha_fin" onchange="calcularDias()"></div>
<div class="field"><label>Días:</label><input type="text" id="total_dias" readonly></div>

<div class="field">
<label>Firma:</label>
<canvas id="firma"></canvas>
<button class="clear-btn" onclick="clearCanvas('firma')">Borrar firma</button>
</div>

<button onclick="enviar()">Enviar Solicitud</button>
<p id="mensaje" style="color:green; margin-top:10px;"></p>
</div>

<script>
// calcular días
function calcularDias(){
  const inicio=document.getElementById('fecha_inicio').value;
  const fin=document.getElementById('fecha_fin').value;
  if(inicio && fin){
    const diff=(new Date(fin)-new Date(inicio))/(1000*60*60*24)+1;
    document.getElementById('total_dias').value=diff>0?diff:0;
  }
}

// canvas firma
let canvas=document.getElementById('firma'), ctx=canvas.getContext('2d'), dibujando=false;
canvas.width=canvas.offsetWidth; canvas.height=canvas.offsetHeight;
canvas.addEventListener('mousedown',e=>{dibujando=true; const r=canvas.getBoundingClientRect(); ctx.beginPath(); ctx.moveTo(e.clientX-r.left,e.clientY-r.top);});
canvas.addEventListener('mousemove',e=>{if(dibujando){const r=canvas.getBoundingClientRect(); ctx.lineTo(e.clientX-r.left,e.clientY-r.top); ctx.stroke();}});
window.addEventListener('mouseup',()=>dibujando=false);
canvas.addEventListener('touchstart',e=>{dibujando=true; const r=canvas.getBoundingClientRect(); ctx.beginPath(); ctx.moveTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top); e.preventDefault();},{passive:false});
canvas.addEventListener('touchmove',e=>{if(dibujando){const r=canvas.getBoundingClientRect(); ctx.lineTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top); ctx.stroke(); e.preventDefault();}},{passive:false});
function clearCanvas(id){const c=document.getElementById(id); c.getContext('2d').clearRect(0,0,c.width,c.height);}

// enviar datos a Google Sheets
function enviar(){
  const firmaData=canvas.toDataURL();
  const data={
    nombre: document.getElementById('nombre').value,
    dni: document.getElementById('dni').value,
    empresa: document.getElementById('empresa').value,
    tipo: document.getElementById('tipo').value,
    fecha_inicio: document.getElementById('fecha_inicio').value,
    fecha_fin: document.getElementById('fecha_fin').value,
    dias: document.getElementById('total_dias').value,
    firma: firmaData
  };
  fetch(https://script.google.com/macros/s/AKfycbwUkHUalD5Np-Q35YXWhvoFgA1FeIuW2-a6pb3SdUZtl990oX1CatehlsalLlhVRnqb/exec,{
    method:'POST',
    body: JSON.stringify(data)
  }).then(res=>res.json()).then(res=>{
    document.getElementById('mensaje').textContent="✅ Solicitud enviada correctamente!";
  }).catch(err=>{
    document.getElementById('mensaje').textContent="❌ Error al enviar, revise conexión.";
  });
}
</script>

</body>
</html>
